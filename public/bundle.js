(()=>{var e={637:()=>{const e=document.querySelector("#table-shows table");e.querySelectorAll("thead tr th").forEach(((t,r)=>t.addEventListener("click",(t=>s(e,r)))));const t=document.querySelector("#table-episodes table");function s(e,t){let s=e.rows,a=[];for(let e=1;e<s.length;e++){let r=s[e].getElementsByTagName("TD")[t].innerHTML;r=1===t||2===t?r.toLowerCase():Number(r),a.push([r,e])}let[o,n]=r(a,!0);n&&([o,n]=r(a,!1));let l,i=e.cloneNode(!0).rows;for(let e=1;e<s.length;e++)l=i[o[e-1][1]].cloneNode(!0),l.querySelector("td").innerHTML=e,s[e].replaceWith(l);i=null,l=null}function r(e,t=!0){let s=!0;for(let r=1;r<e.length;r++){let a=e[r],o=r-1;if(t)for(;o>=0&&e[o][0]>a[0];)e[o+1]=e[o],s=!1,o--;else for(;o>=0&&e[o][0]<a[0];)e[o+1]=e[o],o--;e[o+1]=a}return[e,s]}t.querySelectorAll("thead tr th").forEach(((e,r)=>e.addEventListener("click",(e=>s(t,r)))))},694:()=>{const e=document.querySelectorAll("#table-tabs h2");function t(t){if(!t.target.classList.contains("active")){const s=t.target.getAttribute("data-tab-index"),r=document.querySelectorAll(".table");for(let t=0;t<e.length;t++)e[t].classList.remove("active"),r[t].classList.remove("active");e[s].classList.add("active"),r[s].classList.add("active")}}for(let s of e)s.addEventListener("click",t)}},t={};function s(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}(()=>{"use strict";Chart.defaults.font.family="'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",Chart.defaults.color="#747474";const e=["rgb(54, 162, 235, 0.5)","rgb(255, 99, 132, 0.5)","rgb(255, 159, 64, 0.5)","rgb(255, 205, 86, 0.5)","rgb(75, 192, 192, 0.5)","rgb(153, 102, 255, 0.5)","rgb(201, 203, 207, 0.5)","rgb(54, 162, 235, 0.5)","rgb(255, 99, 132, 0.5)","rgb(255, 159, 64, 0.5)"],t=["rgb(255, 99, 132, 0.5)","rgb(54, 162, 235, 0.5)","rgb(255, 159, 64, 0.5)"],r=["rgb(255, 99, 132, 0.05)","rgb(54, 162, 235, 0.05)","rgb(255, 159, 64, 0.05)"],a=document.getElementById("bar-shows"),o=document.getElementById("bar-episodes"),n=document.getElementById("bar-genres");let l={plugins:{title:{display:!0,text:"Top Shows",font:{size:22}}},indexAxis:"y",scales:{y:{beginAtZero:!0},x:{ticks:{precision:0}}},responsive:!0,maintainAspectRatio:!1},i=JSON.parse(JSON.stringify(l));i.plugins.title.text="Top Episodes";let d=JSON.parse(JSON.stringify(l));d.plugins.title.text="Genre Rankings";const c=document.getElementById("trends-shows"),u=document.getElementById("trends-episodes"),h=document.getElementById("trends-referrals"),p={callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+=e.parsed.y.toLocaleString()+(1===e.parsed.y?" referral":" referrals")),t}}},g={plugins:{title:{display:!0,text:"Top Shows Trends",font:{size:22}},tooltip:p},scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"eeee, MMM d, yyyy",displayFormats:{day:"eee"}}},y:{beginAtZero:!0,ticks:{precision:0}}},responsive:!0,maintainAspectRatio:!1},y=["Please fill out this field","Please use this format: yyyy-mm-dd","The end date cannot be earlier than the start date","There must be both a start date and an end date","The start date cannot be earlier than data availability","There was an error"];async function m(e={start:"default",end:"default"}){try{const t=await fetch("api/get-data.php",{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Network response was not OK");return t.text()}catch(e){throw console.error("Error fetching data:",e.message),e}}function f(e){return new Date(e+"T00:00:00")}function b(){document.querySelector("#loader").classList.add("hide"),document.querySelector("main").classList.add("fade-in")}function w(s){if(s=function(e){try{return JSON.parse(e)}catch{throw console.log(e),new Error("Network response was not valid JSON")}}(s),console.log(s),function(e){const t=document.querySelector("#date-error"),s=e.errors;if(e.errors.anyErrorsExist){let r=5;return s.datesEmpty?r=3:s.datesNotFormatted?r=1:s.dataNotAvailable?r=4:s.datesNotOrdered&&(r=2),t.innerHTML=y[r],4===r&&(t.innerHTML+=": "+e.availableDates.min),t.classList.add("fade-in"),!0}return!1}(s))return;const m=document.querySelector("#start-date");m.min=s.availableDates.min,m.max=s.availableDates.max,m.value=s.requestedDates.start;const b=document.querySelector("#end-date");b.min=s.availableDates.min,b.max=s.availableDates.max,b.value=s.requestedDates.end;let w=[],v=[],C=[],S=[],T=[],x=[],q=[],D=new Map([["History",0],["Arts and Music",0],["Culture",0],["News and Public Affairs",0],["Drama",0],["Indie Films",0],["Science and Nature",0],["Food",0],["Home and How To",0],["Not Set",0]]),L=[],N=f(s.requestedDates.trendsStart);const E=f(s.requestedDates.end);for(;N<=E;)L.push(new Date(N)),N.setDate(N.getDate()+1);for(let e=0;e<10;e++){if(s.shows[e]&&(w.push(s.shows[e].Show),v.push(s.shows[e].Pageviews),e<3)){let a={data:new Array(L.length).fill(0)};a.id=s.shows[e].ID,a.label=s.shows[e].Show,a.borderColor=t[e],a.backgroundColor=r[e],a.fill=!0,T.push(a)}if(s.episodes[e]){let a=s.episodes[e].Show+" - "+s.episodes[e].Episode;if(C.push(a),S.push(s.episodes[e].Pageviews),e<3){let o={data:new Array(L.length).fill(0)};o.id=s.episodes[e].VideoID,o.label=a,o.borderColor=t[e],o.backgroundColor=r[e],o.fill=!0,x.push(o)}}}let A=0,M=0;for(let e=0;e<L.length;e++){let t,r,a=L[e];for(q.push(s.referralsTrends[e].Pageviews),t=A<s.showsTrends.length?f(s.showsTrends[A].Date):null;t&&t.getTime()===a.getTime();){let r=s.showsTrends[A].ID,a=T.find((e=>e.id===r));a&&(a.data[e]=s.showsTrends[A].Pageviews),A+=1,t=A<s.showsTrends.length?f(s.showsTrends[A].Date):null}for(r=M<s.episodesTrends.length?f(s.episodesTrends[M].Date):null;r&&r.getTime()===a.getTime();){let t=s.episodesTrends[M].VideoID,a=x.find((e=>e.id===t));a&&(a.data[e]=s.episodesTrends[M].Pageviews),M+=1,r=M<s.episodesTrends.length?f(s.episodesTrends[M].Date):null}}const k=document.querySelector("#table-shows table tbody"),O=document.createDocumentFragment(),V=document.querySelector("#table-row-template");for(let e=0;e<s.shows.length;e++){let t=s.shows[e].Genre;t=t?t.trim().replace(/\s+/g," "):"Not Set";const r=parseFloat(s.shows[e].Pageviews),a=D.has(t)?D.get(t):0;D.set(t,a+r);let o=document.importNode(V.content,!0),n=o.querySelectorAll("td");n[0].textContent=e+1,n[1].textContent=s.shows[e].Show,n[2].textContent=t,n[3].textContent=s.shows[e].Pageviews,n[4].textContent=s.shows[e].Users,n[5].textContent=s.shows[e].Duration,O.append(o)}const P=document.querySelector("#table-episodes table tbody"),F=document.createDocumentFragment();for(let e=0;e<s.episodes.length;e++){let t=document.importNode(V.content,!0),r=t.querySelectorAll("td");r[0].textContent=e+1,r[1].textContent=s.episodes[e].Show,r[2].textContent=s.episodes[e].Episode,r[3].textContent=s.episodes[e].Pageviews,r[4].textContent=s.episodes[e].Users,r[5].textContent=s.episodes[e].Duration,F.append(t)}const I=s.shows.reduce(((e,t)=>e+parseInt(t.Pageviews)),0);for(document.querySelector("#total-referrals").innerHTML=I,function(t,s,r,c,u){let h=Chart.getChart(a);h&&h.destroy();let p=Chart.getChart(n);p&&p.destroy();const g=[...t.entries()],y=new Map(g.sort(((e,t)=>t[1]-e[1])));s.length>0&&(h=new Chart(a,{type:"bar",data:{labels:s,datasets:[{label:"Total Referrals",data:r,backgroundColor:e[0],borderWidth:0}]},options:l}),p=new Chart(n,{type:"bar",data:{labels:[...y.keys()],datasets:[{label:"Total Referrals",data:[...y.values()],backgroundColor:e[0],borderWidth:0}]},options:d}),document.querySelector(".graphic.bar.shows").classList.remove("hide"),document.querySelector(".graphic.bar.genres").classList.remove("hide"));let m=Chart.getChart(o);m&&m.destroy(),c.length>0&&(m=new Chart(o,{type:"bar",data:{labels:c,datasets:[{label:"Total Referrals",data:u,backgroundColor:e[0],borderWidth:0}]},options:i}),document.querySelector(".graphic.bar.episodes").classList.remove("hide"))}(D,w,v,C,S),function(e,s,a,o){const n=new Date,l=e[0],i=e[e.length-1],d=n.getTime()-i.getTime();Math.floor(d/864e5)>6&&(g.scales.x.time.displayFormats.day="MMM d",l.getFullYear()<n.getFullYear()&&(g.scales.x.time.displayFormats.day+=", yyyy"));let y=JSON.parse(JSON.stringify(g));y.plugins.title.text="Top Episodes Trends",y.plugins.tooltip=p;let m=JSON.parse(JSON.stringify(y));m.plugins.title.text="Daily Referrals",m.plugins.tooltip=p,m.plugins.legend={display:!1};let f=Chart.getChart(c);f&&f.destroy();let b=Chart.getChart(u);b&&b.destroy();let w=Chart.getChart(h);w&&w.destroy(),e.length>1&&(f=new Chart(c,{type:"line",data:{labels:e,datasets:s},options:g}),b=new Chart(u,{type:"line",data:{labels:e,datasets:a},options:y}),w=new Chart(h,{type:"line",data:{labels:e,datasets:[{data:o,borderColor:t[1],backgroundColor:r[1],fill:!0}]},backgroundColor:"rgba(255, 26, 104, 0.2)",options:m}),[...document.querySelectorAll(".graphic.trends")].forEach((e=>e.classList.remove("hide"))))}(L,T,x,q);k.firstChild;)k.removeChild(k.firstChild);for(;P.firstChild;)P.removeChild(P.firstChild);k.append(O),P.append(F)}const v=document.querySelector("#start-date"),C=document.querySelector("#end-date");document.querySelector("#submit").addEventListener("click",(function(e){if(e.preventDefault(),function(){let e=!1;const t=(s=v.value,r=C.value,new Date(s)<=new Date(r));var s,r;return v.validity.valueMissing?(v.setCustomValidity(y[0]),v.reportValidity()):C.validity.valueMissing?(C.setCustomValidity(y[0]),C.reportValidity()):v.validity.patternMismatch?(v.setCustomValidity(y[1]),v.reportValidity()):C.validity.patternMismatch?(C.setCustomValidity(y[1]),C.reportValidity()):t?(v.setCustomValidity(""),C.setCustomValidity(""),e=!0):(C.setCustomValidity(y[2]),C.reportValidity()),e}()){const e={start:v.value,end:C.value},t=document.querySelector("#date-error"),s=[...document.querySelectorAll(".graphic.trends")];document.querySelector("main").classList.remove("fade-in"),document.querySelector("#loader").classList.remove("hide"),t.classList.remove("fade-in"),t.innerHTML="",s.forEach((e=>e.classList.add("hide"))),m(e).then((e=>w(e))).then((()=>b())).catch((e=>console.log(e)))}})),s(694),s(637),m().then((e=>w(e))).then((()=>b())).catch((e=>console.log(e)))})()})();